function ABuffer(t){this.buf=t>0?new Uint8Array(t):null,this.offset=0,this.dataSize=0,this.emptyChar=32,this.emptyNumChar=48,this.charset=null,this.encoder=null,this.decoder=null}ABuffer.MAX_INT=Math.pow(2,53),ABuffer.MASK31=2147483647,ABuffer.MASK32=4294967295,ABuffer.VAL31=2147483648,ABuffer.VAL32=4294967296,ABuffer.prototype.getBufSize=function(){return this.buf.length},ABuffer.prototype.getBuffer=function(){return this.buf},ABuffer.prototype.getOffset=function(){return this.offset},ABuffer.prototype.getCharset=function(){return this.charset},ABuffer.prototype.setBuffer=function(t){this.buf=t},ABuffer.prototype.setOffset=function(t){this.offset=t},ABuffer.prototype.addOffset=function(t){this.offset+=t},ABuffer.prototype.setBufferByString=function(t){try{this.buf=this.encoder.encode(t)}catch(e){alert("setBufferByString:encoding error - "+t)}},ABuffer.prototype.setDataSize=function(t){this.dataSize=t},ABuffer.prototype.getDataSize=function(){return this.dataSize},ABuffer.prototype.EOF=function(){return this.offset>=this.dataSize},ABuffer.prototype.setCharset=function(t){this.charset=t,this.charset?(this.encoder=new ATextEncoder(this.charset),this.decoder=new ATextDecoder(this.charset)):(this.encoder=null,this.decoder=null)},ABuffer.prototype.setEmptyChar=function(t){this.emptyChar=t},ABuffer.prototype.setEmptyNumChar=function(t){this.emptyNumChar=t},ABuffer.prototype.copyBuffer=function(t,e){this.buf.set(t,e)},ABuffer.prototype.fillBuffer=function(t,e){e||(e=this.buf.length);for(var r=0;r<e;r++)this.buf[r]=t},ABuffer.prototype.subArray=function(t,e){return this.buf.subarray(t,e)},ABuffer.prototype.setByte=function(t,e){this.buf[t]=e,this.offset=t+1},ABuffer.prototype.addByte=function(t){this.setByte(this.offset,t)},ABuffer.prototype.getByte=function(t){return this.offset=t+1,this.buf[t]},ABuffer.prototype.nextByte=function(){return this.getByte(this.offset)},ABuffer.prototype.setWord=function(t,e){this.setType(t,2,e)},ABuffer.prototype.addWord=function(t){this.setType(this.offset,2,t)},ABuffer.prototype.getWord=function(t){return this.getType(t,2,!0)},ABuffer.prototype.nextWord=function(){return this.getType(this.offset,2,!0)},ABuffer.prototype.getShort=function(t){return this.getType(t,2,!1)},ABuffer.prototype.nextShort=function(){return this.getType(this.offset,2,!1)},ABuffer.prototype.setDWord=function(t,e){this.setType(t,4,e)},ABuffer.prototype.addDWord=function(t){this.setType(this.offset,4,t)},ABuffer.prototype.getDWord=function(t){return this.getType(t,4,!0)},ABuffer.prototype.nextDWord=function(){return this.getType(this.offset,4,!0)},ABuffer.prototype.getInt=function(t){return this.getType(t,4,!1)},ABuffer.prototype.nextInt=function(){return this.getType(this.offset,4,!1)},ABuffer.prototype.setType=function(t,e,r){r=parseInt(r,10);var f=Math.abs(r),o=f%ABuffer.VAL32;(f/=ABuffer.VAL32)>ABuffer.VAL32&&console.log(f+" is outside Int64 range!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"),f|=0;var i,n=this.buf;for(i=e-1;i>=0;i--)n[t+i]=255&o,o=4==i?f:o>>>8;if(r<0){var s=1,u=0;for(i=t+e-1;i>=t;i--)u=(255^n[i])+s,n[i]=255&u,s=u>>8}this.offset=t+e},ABuffer.prototype.addType=function(t,e){this.setType(this.offset,t,e)},ABuffer.prototype.getType=function(t,e,r){this.offset=t+e;var f=0,o=this.buf,i=0,n=1,s=0;r||(i=128&o[t]);for(var u=e-1,h=1;u>=0;u--,h*=256)s=o[t+u],i&&(n=(s=(255^s)+n)>>8,s&=255),f+=s*h;return i?-f:f},ABuffer.prototype.nextType=function(t,e){return this.getType(this.offset,t,e)},ABuffer.prototype.setChar=function(t,e){""==e&&(e=" "),this.buf[t]=e.charCodeAt(0),this.offset=t+1},ABuffer.prototype.addChar=function(t){this.setChar(this.offset,t)},ABuffer.prototype.setOriString=function(t,e,r){r=null==r||void 0==r?"":r.toString();for(var f=0;f<r.length;f++)this.buf[t+f]=r.charCodeAt(f);for(e<1&&(e=r.length);f<e;f++)this.buf[t+f]=this.emptyChar;this.offset=t+e},ABuffer.prototype.addOriString=function(t,e){this.setOriString(this.offset,t,e)},ABuffer.prototype.setString=function(t,e,r){r=null==r||void 0==r?"":r.toString();var f=0;if(this.charset)try{for(var o=this.encoder.encode(r);f<o.length;f++)this.buf[t+f]=o[f];e<1&&(e=o.length)}catch(o){for(alert("encoding error - "+r),f=0;f<r.length;f++)this.buf[t+f]=this.emptyChar;e<1&&(e=r.length)}else{for(;f<r.length;f++)this.buf[t+f]=r.charCodeAt(f);e<1&&(e=r.length)}for(;f<e;f++)this.buf[t+f]=this.emptyChar;this.offset=t+e},ABuffer.prototype.addString=function(t,e){this.setString(this.offset,t,e)},ABuffer.prototype.setNumString=function(t,e,r){r=null==r||void 0==r||isNaN(r)?"0":r.toString();var f=0;if(e<1)e=r.length;else for(var o=e-r.length;f<o;f++)this.buf[t+f]=this.emptyNumChar;for(var i=0;f<e;f++,i++)this.buf[t+f]=r.charCodeAt(i);this.offset=t+e},ABuffer.prototype.addNumString=function(t,e){this.setNumString(this.offset,t,e)},ABuffer.prototype.setSNumString=function(t,e,r){null==r||void 0==r?(r="0",this.buf[t]=43):r<0?(this.buf[t]=45,r=r.toString().substring(1)):(this.buf[t]=43,r=r.toString());var f=1;if(e<1)e=r.length+1;else for(var o=e-r.length;f<o;f++)this.buf[t+f]=this.emptyNumChar;for(var i=0;f<e;f++,i++)this.buf[t+f]=r.charCodeAt(i);this.offset=t+e},ABuffer.prototype.addSNumString=function(t,e){this.setSNumString(this.offset,t,e)},ABuffer.prototype.setBinary=function(t,e,r){if(r){this.buf.set(r,t);for(var f=r.length;f<e;f++)this.buf[t+f]=0}this.offset=t+e},ABuffer.prototype.addBinary=function(t,e){this.setBinary(this.offset,t,e)},ABuffer.prototype.getBase64String=function(t,e){return this.offset=t+e,Base64.btoaArray(this.buf.subarray(t,t+e))},ABuffer.prototype.getOriString=function(t,e,r){for(var f="",o=0;o<e&&0!=this.buf[t+o];o++)f+=String.fromCharCode(this.buf[t+o]);return this.offset=t+e,r?f:$.trim(f)},ABuffer.prototype.nextOriString=function(t,e){return this.getOriString(this.offset,t,e)},ABuffer.prototype.getString=function(t,e,r){var f="";if(this.charset){for(o=0;o<e&&0!=this.buf[t+o];o++);f=this.decoder.decode(this.buf.subarray(t,t+o))}else for(var o=0;o<e&&0!=this.buf[t+o];o++)f+=String.fromCharCode(this.buf[t+o]);return this.offset=t+e,r?f:$.trim(f)},ABuffer.prototype.nextString=function(t,e){return this.getString(this.offset,t,e)},ABuffer.prototype.getStringTo=function(t,e){var r,f="";if(this.charset){for(r=0;!0&&this.buf[t+r]!=e;r++);r>0&&(f=this.decoder.decode(this.buf.subarray(t,t+r)))}else for(r=0;!0&&this.buf[t+r]!=e;r++)f+=String.fromCharCode(this.buf[t+r]);return this.offset=t+r+1,f},ABuffer.prototype.nextStringTo=function(t){return this.getStringTo(this.offset,t)},ABuffer.prototype.getParseInt=function(t,e){for(var r="",f=0;f<e;f++)r+=String.fromCharCode(this.buf[t+f]);return this.offset=t+e,parseInt(r,10)},ABuffer.prototype.nextParseInt=function(t){return this.getParseInt(this.offset,t)},ABuffer.prototype.getParseFloat=function(t,e){for(var r="",f=0;f<e;f++)r+=String.fromCharCode(this.buf[t+f]);return this.offset=t+e,parseFloat(r)},ABuffer.prototype.nextParseFloat=function(t){return this.getParseFloat(this.offset,t)},ABuffer.prototype.getIpString=function(t){var e,r,f="",o="",i=0;for(e=0;e<4;e++){for(o="",r=0;r<3;r++)o+=String.fromCharCode(this.buf[t+i]),i++;f+=e>0?"."+parseInt(o,10):""+parseInt(o,10)}return this.offset=t+i,f},ABuffer.prototype.nextIpString=function(){return this.getIpString(this.offset)},ABuffer.prototype.getBinary=function(t,e){return this.offset=t+e,this.buf.subarray(t,this.offset)},ABuffer.prototype.nextBinary=function(t){return this.getBinary(this.offset,t)},ABuffer.prototype.printBySize=function(t,e,r){this.offset=e>0?e:0;for(var f,o=this.offset,i="",n="",s="",u=0;u<t.length;u++){f=t[u],s="";for(var h=0;h<f;h++)void 0==r?n=String.fromCharCode(this.buf[o++]):(n=this.buf[o++].toString(r)).length<2&&(n="0"+n),s+=n+" ";i+=u+1+" : "+s+"\r\n"}return console.log(i),i},ABuffer.prototype.printBuffer=function(t,e,r){if(0!=e){void 0==t&&(t=0),void 0==e&&(e=this.getBufSize());for(var f="",o="",i=0;i<e;i++)void 0==r?o=String.fromCharCode(this.buf[i+t]):(o=this.buf[i+t].toString(r)).length<2&&(o="0"+o),f+=o+" ",(i+1)%10==0&&(f+="\r\n");return console.log(f),f}};